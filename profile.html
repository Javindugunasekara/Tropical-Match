<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile - Tropical Match</title>
  <link rel="stylesheet" href="assets/css/style.css?v=2">
</head>
<body>
  <header class="game-header">
    <h1>ðŸŒ´ TROPICAL MATCH ðŸŒ´</h1>
  </header>

  <div class="container profile-container">
    <h1 class="title">Profile</h1>
    <div class="profile-box">
      <p><strong>Name:</strong> <span id="userName">Loading...</span></p>
      <p><strong>Email:</strong> <span id="userEmail">Loading...</span></p>
    </div>
    <a href="dashboard.html" class="btn secondary">Back</a>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const nameEl  = document.getElementById('userName');
      const emailEl = document.getElementById('userEmail');

      const token = localStorage.getItem('userToken');

      if (!token) {
        nameEl.textContent  = 'Not logged in';
        emailEl.textContent = '-';
        return;
      }

      const body = new URLSearchParams();
      body.append('token', token);

      fetch('api/get_user.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: body.toString()
      })
        .then(async (res) => {
          if (!res.ok) {
            const text = await res.text();
            console.error('get_user HTTP error:', res.status, text);
            throw new Error('HTTP ' + res.status);
          }
          return res.json();
        })
        .then((data) => {
          console.log('get_user response:', data);
          if (data.success && data.user) {
            nameEl.textContent  = data.user.name || 'Unknown';
            emailEl.textContent = data.user.email || '-';
          } else {
            nameEl.textContent  = 'Not logged in';
            emailEl.textContent = '-';
          }
        })
        .catch((err) => {
          console.error('get_user fetch error:', err);
          nameEl.textContent  = 'Error loading data';
          emailEl.textContent = '-';
        });
    });
  </script>
</body>
</html>
